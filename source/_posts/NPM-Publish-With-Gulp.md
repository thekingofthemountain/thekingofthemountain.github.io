---
title: NPM-Publish-With-Gulp
date: 2021-03-09 20:25:58
categories: Nodejs
tags: 
  - Javascript
  - Nodejs
---

# NPM Publish

## Initial Project

```
  $ mkdir publishDemo
  $ yarn init
  // question name (publishDemo):
  // question version (1.0.0):
  // question description: publishdemo
  // question entry point (index.js):
  // question repository url:
  // question author: Tomas
  // question license (MIT):
  // success Saved package.json
```

初始化結束後會增加一個 package.json

```json
{
  "name": "publishDemo",
  "version": "1.0.0",
  "description": "publishdemo",
  "main": "index.js",
  "author": "Tomas",
  "license": "MIT"
}
```

### Create index.js

```javascript
module.exports = 'hello world';
```

### publish

```
  $ npm login
  // 登入 NPM 的帳號並且驗證信箱
```

```
  $ npm publish
  + publishdemotest@1.0.0
```

![npm publish success](../../../../images/npmpublish/01.png)

## add Gulp

gulpfile.js


```
  $ mkdir src && mv index.js ./src
```

```javascript
const gulp = require("gulp");
const babel = require("gulp-babel");

gulp.task("compile", () => {
  return gulp
    .src("./src/**/*.js")
    .pipe(
      babel({
        presets: ["es2015", "stage-2"],
        plugins: []
      })
    )
    .pipe(gulp.dest("./build"));
});

gulp.task("default", ["compile"]);

```

```
  $ gulp
  // result
  .
  ├── build
  │   └── index.js
  ├── gulpfile.js
  ├── package.json
  ├── src
  │   └── index.js
  └── yarn.lock
```

### Git

.gitignore

```
# Logs
logs
*.log
npm-debug.log*

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directory
# https://docs.npmjs.com/misc/faq#should-i-check-my-node-modules-folder-into-git
node_modules
build
```

[publishdemo](https://github.com/horsekitlin/npmpublishwithgulp)

### update NPM version and main

```json
{
  "name": "publishdemotest",
  "version": "1.0.1",
  "description": "publishdemo",
  "main": "./build/index.js",
  "author": "Tomas",
  "license": "MIT",
  "devDependencies": {
    "babel-core": "^6.26.0",
    "babel-plugin-transform-runtime": "^6.23.0",
    "babel-preset-es2015": "^6.24.1",
    "babel-preset-stage-0": "^6.24.1",
    "gulp": "^3.9.1",
    "gulp-babel": "^7.0.0"
  }
}
```

### 重新 publish

```
  $ npm publish
  //+ publishdemotest@1.0.1
```

這時如果我在其他專案從 NPM 下載結果如下圖

```
  $ yarn add publishdemotest
```

```
  $ tree ./node_modules/publishdemotest
  //result

./node_modules/publishdemotest
├── gulpfile.js
├── package.json
├── src
│   └── index.js
└── yarn.lock
```

並沒有build 這個 folder

但是因為在 package.json 中我們將進入點設定為 ```./build/index.js```

所以會造成我們引入時的錯誤

NPM 會自動將 .gitignore 設定為預設的設定檔案

但是我們希望可以有其他的設定

我們可以增加一個 .npmignore

```
# Logs
logs
*.log
npm-debug.log*
node_modules

*error*
```

我們將build 移除在 .npmignore 中

再將 package.json 的version 升級

再重新publish 一次

在 Demo 的 project 升級 package

```
  $ yarn upgrade publishdemotest
```

```
  $ tree node_modules/publishdemotest

  node_modules/publishdemotest
  ├── build
  │   └── index.js
  ├── gulpfile.js
  ├── package.json
  ├── src
  │   └── index.js
  └── yarn.lock
```

透過 .npmignore 就可以達到我們需要的效果

同樣如果不希望使用者還需要安裝相關套件

也可以把 node_modules 移除 .npmignore 中

如此使用者就不需要安裝相關套件

也可以達到鎖定版本的效果
